
<html>
<head>
    <title>Parkhaus</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>




<script type="text/javascript">
    if (window.location.search != '')
        var url = window.location.search;
    var parkplatzspaceCount = parseInt((url.replace('?anzahl=','')),10);
</script>
<h1>Parkhaus</h1>
<h2>Uhrzeit:</h2>
<div id="digitalclock" class="clock">Clock</div>
<script src="javascript/digitalclock.js"></script>
<h4>Anzahl Parkplätze gesamt:</h4>
<p id="anzahlParkplaetzeGesamt"></p>
<h4>Anzahl Freie Parkplätze:</h4>
<p id="anzahlFreieParkplaetze">
</p>

<button id="btnNewCarToPark" onclick="CarsInList()">Neues Auto in Parkhaus</button>
<div id="carPark"></div>
<form  id="Bezahlvorgang">
        <h1>Bezahlen</h1>
       <label for="Ticket-Nr.">Ticket-Nr.
           <select id="autosImParkhausbezahlen"></select>
       </label>
        <h3>Sondertarif</h3>
        <input type="radio" id="keintarif" name="tarif" value="kein">
        <label for="keintarif">Kein</label>
       <input type="radio" id="familientarif" name="tarif" value="familie">
       <label for="familientarif">Familie</label>
       <input type="radio" id="mitarbeitertarif" name="tarif" value="mitarbeiter">
       <label for="mitarbeitertarif">Mitarbeiter</label>
       <input type="radio" id="behindertentarif" name="tarif" value="behindert">
       <label for="behindertentarif">Behindert</label>
       <input type="radio" id="frauentarif" name="tarif" value="frau">
       <label for="frauentarif">Frau</label>
    </br>
    </br>
        <button type="submit">Best&aumltigen</button>
        <button type="reset">Widerrufen</button>
    </form>
 <button id="btnPay" onclick="pay()">Bezahlen</button>
</br>
</br>
<select id="autosImParkhausbezahltLoeschen"></select>
<button id="addNewObserver">Add new Observer checkbox</button>
<input id="mainCheckbox" type="checkbox"/>
<div id="observersContainer"></div>

<script type="text/javascript">


// Define properties of the Observer
function Observerlist(){
    this.observerlist = [];
}

// Function for adding observers to the list
Observerlist.prototype.add = function(obj){
    return this.observerlist.push(obj);
}
// Function for counting the elements in the list
Observerlist.prototype.count = function(){
    return this.observerlist.length;
}
// Getting an element at an index
Observerlist.prototype.get = function(index){
    if(index > -1 && index < this.observerlist.length){
        return this.observerlist[index];
    }
}
// Getting the index of an element
Observerlist.prototype.indexOf = function(obj, startIndex){
    var i = startIndex;

    while(i < this.observerlist.length){
        if(this.observerlist[i]===obj){
            return i;
        }
        i++;
    }

    return -1;
};
// Remove Element at a certain Index
Observerlist.prototype.removeAt = function(index){
    this.observerlist.splice(index,1);
}
// Defines the custom action an observer does
function Observer(){
    this.update = function(){
    
    };
}


// Subscriber
function Subject(){
    this.observers = new Observerlist();
}
// Adds an observer to the list
Subject.prototype.addObserver = function(observer){
    this.observers.add(observer);
}
// Removes an observer from the list
Subject.prototype.removeObserver = function(observer){
    this.observers.removeAt(this.observers.indexOf(observer,0));
}
// Notifies the observers, that an event has occured
Subject.prototype.notify = function(context){
    var observerCount = this.observers.count();
    for(var i=0; i <observerCount; i++){
        this.observers.get(i).update(context);
    }
}

// Extends Objects
function extend(obj,extension){
    for(var key in extension){
        obj[key] = extension[key];
    }
}
// Variables that hold the Objects in the DOM
var controlCheckbox = document.getElementById("btnPay"),
    addBtn = document.getElementById("btnNewCarToPark"),
    container = document.getElementById("carPark");

extend(controlCheckbox, new Subject());

// 
controlCheckbox.onclick = function(){
    controlCheckbox.notify(controlCheckbox.checked);
};

// This Button adds a new Observer
addBtn.onclick = addNewObserver;
// Function for adding an observer
function addNewObserver(){
    var check = document.createElement("input");
    check.type = "checkbox";
    extend(check,new Observer());
    check.update = function(value){
    console.log("Test")
};

controlCheckbox.addObserver(check);
container.appendChild(check);

};







    var i=0;
    var loschenhilfemusswiederwech=0;
    var parkhausSize=0;
    parkhausSize=parseInt(parkplatzspaceCount.valueOf(),10);
    var pricePerHour=2.0;
    var CarArray=[];
    var payedCarsArray=[];
    document.getElementById("anzahlFreieParkplaetze").innerText=""+parkhausSize-i+"";
    document.getElementById("anzahlParkplaetzeGesamt").innerText=""+parkhausSize+"";
    function x() {if(parkhausSize>0)
    {document.getElementById("anzahlFreieParkplaetze").innerText=""+parkhausSize-i+"";}}
    var payedCars=function (idd,datee,datenow,pricee,tariff) {
        this.id=idd;
        this.date=datee;
        this.leftParkhouse=datenow;
        this.price=pricee;
        this.tarif=tariff;
    }
    var Auto=function () {
        this.id=Math.random();
        this.date=new Date();
        function Getid() {
            return this.id;
        }
    }

    function CarsInList() {
        if(i<parkhausSize) {

            i=i+1;
            x()
            a=new Auto();
            CarArray.push(a);
            //in anzeige Liste eintragen
            var option = new Option('Autoid: '+a.id);
            var selectpayList= document.getElementById('autosImParkhausbezahlen');
            selectpayList.options[i-1]=option;

        }
        else
        {
            window.alert("Das Parkhaus ist voll.");
        }



    }
    function listeRefresh () {
        var selectElement = document.getElementById('autosImParkhausbezahlen');
        var kkkk;
        for(kkkk=0;kkkk<CarArray.length;kkkk++){
            var option1 = new Option('Autoid: '+CarArray[kkkk].id);
            selectElement.options[kkkk] = option1;
        }
    }

function pay(){
    var newHelpArray=[];
        if(i==0){
            window.alert("Es ist noch kein Auto bzw. nicht mehr im Parkhaus. Sie können noch kein Ticket bezahlen.");
        }
        else{
            i=i-1;
            var list=document.getElementById("autosImParkhausbezahlen");
            var strUser = list.options[list.selectedIndex].value;
            var splittet=strUser.split(": ");
            var kkk;
            for(kkk=0;kkk<CarArray.length;kkk++){
            if(splittet[1]==CarArray[kkk].id){
                var datenow=new Date();
                var millisecondsSubDate=(datenow-CarArray[kkk].date);
                var secondsSubDates=millisecondsSubDate/1000;
                var priceCar=secondsSubDates*pricePerHour;
                var tarif;
                document.getElementById('keintarif').checked=true;
                if(document.getElementById('keintarif').checked){
                        tarif='keintariif';
                }
                else if(document.getElementById('familientarif').checked){
                        tarif='familientarif';
                        var familientarif=0.10;
                        priceCar=(priceCar)-(priceCar*familientarif);
                }
                else if(document.getElementById('mitarbeitertarif').checked){
                        tarif='mitarbeitertarif';
                        var mitarbeitertarif=0.2;
                        priceCar=(priceCar)-(priceCar*mitarbeitertarif);
                }
                else if(document.getElementById('behindertentarif').checked){
                        tarif='behindertentarif';
                        var behindertentarif=0.3;
                        priceCar=(priceCar)-(priceCar*behindertentarif);
                }     
                else if(document.getElementById('frauentarif').checked){
                        tarif='frauentarif';
                        var frauentarif=0.05;
                        priceCar=(priceCar)-(priceCar*frauentarif);
                }                             
                b=payedCars(CarArray[kkk].id,CarArray[kkk].date,datenow,priceCar,tarif);
                payedCarsArray.push(b);
                


            }else{
                newHelpArray.push(CarArray[kkk]);
            }}
            var x;
            var list=document.getElementById("autosImParkhausbezahlen");
            for(x=0;x<CarArray.length;x++){
                list.options[x]=null;
            }
            CarArray=newHelpArray;
            

            listeRefresh();
        }
}
    </script>
<script>

// Class for customers
class Kunde{
constructor(id,name){
    this.id = id;
    this.name = name;
   
}

get name(){
    return this.name;
}

}

// class Family
class Famile extends Kunde{

constructor(id,name,anzahlPersonen){
    super(id,name);
    this.anzahlPersonen = anzahlPersonen;
}


}

// class Employee
class Mitarbeiter{

constructor(id,name,gehalt,arbeitsbezeichnung){
    this.id = id;
    this.name = name;
    this.gehalt = gehalt;
    this.arbeitsbezeichnung = arbeitsbezeichnung;
}

get name(){
    return this.name;
}

get gehalt(){
    return this.gehalt;
}

get arbeitsbezeichnung(){
    return this.arbeitsbezeichnung;
}


}

// class Manager
class Manager extends Mitarbeiter{
    constructor(id,name,gehalt,arbeitsbezeichnung){
        super(id,name,gehalt,arbeitsbezeichnung);
    }
}

// class Boss of parking garage
class Parkhausbetreiber extends Mitarbeiter{
    constructor(id,name,gehalt,arbeitsbezeichnung){
        super(id,name,gehalt,arbeitsbezeichnung);
    }
}

// Klasse der Schrankenwärter
class Schrankenwärter extends Mitarbeiter{
    constructor(id,name,gehalt,arbeitsbezeichnung){
        super(id,name,gehalt,arbeitsbezeichnung);
    }
}

// Klasse der Einweiser
class Einweiser extends Mitarbeiter{
    constructor(id,name,gehalt,arbeitsbezeichnung){
        super(id,name,gehalt,arbeitsbezeichnung);
    }
}

// class Investor
class Investor extends Kunde{   
    constructor(id,name,gehalt,arbeitsbezeichnung){
        super(id,name,gehalt,arbeitsbezeichnung);
    }
}



// Funktion, um ein Objekt in JSON-Format zu überführen
    function createJSON(Cars){

       var string = JSON.stringify(Cars);
       console.log(string);


    }


        var neuesHelpArray=[];
        if(i==0){
            window.alert("Es ist noch kein Auto bzw. nicht mehr im Parkhaus. Sie können noch kein Ticket bezahlen.");
        }
        else{
            var liste=document.getElementById("autosImParkhaus");
            var strUser = liste.options[liste.selectedIndex].value;
            var splittet=strUser.split(": ");
            var kkk;
            for(kkk=0;kkk<arrayAuto.length;kkk++){
            if(splittet[1]==arrayAuto[kkk].id){
                b=BezahlteAutos(arrayAuto[kkk].id,arrayAuto[kkk].date);
                bezahlAutosArray.push(b);

            }else{
                neuesHelpArray.push(arrayAuto[kkk]);
            }}
            var x;
            var liste=document.getElementById("autosImParkhaus");
            for(x=0;x<arrayAuto.length;x++){
                liste.options[x]=null;
            }
            arrayAuto=neuesHelpArray;
            console.log(arrayAuto);
            createJSON(arrayAuto);
            listeRefresh();
        }
    

</script>
</body>
</html>
